

## 简易的web应用

```js
// 1.监听端口
const express = require('express')
const app = express()
app.listen(3000, () => { console.log('pyg')})
// 2.定义业务基础
app.get('/', (req,res,next) => {
    res.send('serverok')
})
```

## 错误处理需求

- 错误统一处理
  1. 资源未找到
  2. 程序运行错误

```js
// 3.错误统一处理
// 3.1资源未找到
app.use((req, res, next) => { 
    //如果请求走到这个中间件 证明所有的业务不符合URL 资源未找到
    const err = new Error('not found');
    next(err) //交给下一个程序运行错误中间件处理
})
// 3.2程序运行错误
app.use((err, req, res, next) => { 
    // 运行异常走这个中间件
   // 1.如果是开发环境(能够直观的观察到异常信息 准确的定位到错误的代码)
   // 2.如果是生产环境(渲染两个类型的页面 404 500页面 )
})
```

## 环境变量获取

```js
// cross-env插件判断环境变量

// 1.windows下
    // set NODE_ENV=production 
    // echo %NODE_ENV%
// 2.cross-env插件：好处跨平台 在不同的系统都可以使用 注意：设置环境变量是在内存中
//  const createError = require('http-errors')
	// 生产环境
    cross-env NODE_ENV=production node app.js 
    // 开发环境
    cross-env NODE_ENV=development node app.js 
```

## 开发环境和生产环境设置

1. 配置package.json
2. 判断环境变量 app.js

```js
// 1.配置package.json
"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
     //开发环境
    "dev": "cross-env NODE_ENV=development nodemon app.js ",
     //生产环境
    "start": "cross-env NODE_ENV=production node app.js "
},
// 2.判断环境变量 app.js
app.use((err, req, res, next) => { 
    //怎么获取系统的环境变量
    const env = req.app.get('env')
    //console.log(env)
    if (env === 'development') {
        //开发环境(把具体的错误信息输出到页面)
    } else { 
        //生产环境（渲染两个类型的页面  404  500 页面  美观一些）
    }
})
```

## 开发环境的信息错误处理

```js
// 1.const Youch = require('youch')
// 2.调用方法
if (env === 'development') {
    //把具体的错误信息输出到页面
    //使用youch包 美化错误信息  准确的定位错误的位置
    //res.send(err)
    new Youch(err, req).toHTML().then((html) => res.send(html))
}else{
    //TODO
}
//3.程序运行也有可能出错(测试)
app.get('/', (req, res, next) => {
    throw new Error('自己抛出的异常')
    res.send('serverok')
})
```

## art-template模板引擎配置

那接下来 我是不是处理生产环境啊  生产环境是不是得扔出去404 500页面   是不是得用模板引擎啊

那好接下来第一步是不是安装模板引擎 第二部是不是设置模板引擎 第三布 测试模板引擎

```js
//npm i art-template express-art-template
//1.引包
const artTemplate=require('express-art-template')
//2.设置一个叫art的模板引擎
app.engine('art', artTemplate);
//2.1默认页面修改后被缓存、压缩  模板引擎默认的环境是生产环境
//3.设置缓存刷新
app.set('view options', {
    //3.1 debug 使用布尔值 false生产环境  true 开发环境 实时更新页面 不进行压缩
    debug:process.env.NODE_ENV==='development'
})
//测试开发环境:
//app.set('view options', {debug:true})
res.render('error.art')
```

## 生产环境的错误页面输出

错误模板是不是扔出去了 咱们是不是得扔出去404和500页面  

咱们是不是只需要获取状态码 判断一下就可以

给大家介绍一个好玩意http-errors

他可以创造一个错误状态码后面跟着错误信息

1. 引包
2. 根据方法创建状态码 返回错误
3. 传到error模板一个status属性

```js
//1.引包
const createError = require('http-errors')
//2.根据方法创建状态码 返回错误
    //2.1 
    throw createError(500,'自己的错误')
    //2.2
    next(createError(404, 'not found'))   
//3.传到error模板一个status属性
 res.render('error.art', {status:err.status})
//4.根据class展示
<div class="box {{status===404?'error404':'error500'}}"></div>
```

## 配置静态资源

状态码我们是不是拿到了 接下来是不是判断状态码输出资源就可以了

但是 我们是不是没有配置静态资源   怎么配置静态资源啊 是不是express.static一下可以了

但是为了方便我们是不是 得配置绝对路径  那配置绝对路径是不是得用path模块 path.join

网站打开的时候咱们是不是走我们根路径的时候 加载

1. 引包
2. 配置绝对路径

```js
//1.引包
const path = require('path');
//2.配置绝对路径
app.use('/',express.static(path.join(__dirname,'./public')))
```

## 网站图标处理

现在是不是404和500 绝对路径处理好了  但是有个小问题

就是看看我们上面的小图标 favicon  www.baidu.com/favicon.ico

1.装express-favicon  2.调用  3.测试   

注意问题: favicon.ico 后安眠

```js
/*4.配置一些公用的中间件*/
/*4.1 配置模版引擎 art-template*/
app.engine('art', artTemplate)  //设置一个叫art的模版引擎
app.set('view options', {debug: process.env.NODE_ENV === 'development'})
/*4.2 配置静态资源暴露*/
app.use('/',express.static(path.join(__dirname,'./public')))
/*4.3 浏览器会自动的发送一个网站小图片的请求  是不是只能放到这里根目录经下
//建议大家使用 express-favicon 统一处理小图标
const favicon = require('express-favicon')
app.use(favicon(path.join(__dirname,'./favicon.ico')))
```